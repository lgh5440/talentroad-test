<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>달란트로드 — 은사·성향 검사 (테스트 4문항)</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/html2pdf.js@0.10.1/dist/html2pdf.bundle.min.js"></script>
<style>
  /* 선택된 라벨 색상 강조 */
  .choice input:checked + label{ border-color:#6d28d9; box-shadow:0 0 0 3px rgba(109,40,217,.15); background:#faf5ff; }
  /* 비활성화 버튼 투명도 */
  .btn-disabled { opacity:.5; pointer-events:none; }
  /* 결과 카드 상단 강조 디자인 */
  .result-header { border-bottom: 2px solid #e5e7eb; padding-bottom: 1.5rem; margin-bottom: 1.5rem; }
  /* 조합 설명 내 키(L, C, S 등) 강조 */
  .combo-key-highlight { font-weight: bold; color: #6d28d9; }
</style>
</head>
<body class="bg-gradient-to-br from-sky-100 to-emerald-100 min-h-screen text-slate-800">

<header class="max-w-5xl mx-auto px-4 py-6 flex items-center justify-between">
  <div class="flex items-center gap-3">
    <img src="/icons/dove.png" alt="달란트로드" class="h-8 w-8" onerror="this.style.display='none'"/>
    <h1 class="text-xl font-bold text-violet-700">달란트로드</h1>
  </div>
</header>

<main class="max-w-4xl mx-auto px-4 pb-20">

  <section id="screen-start" class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-8 sm:p-12">
    <div class="space-y-8">
      <h2 class="text-3xl sm:text-4xl font-extrabold tracking-tight text-slate-800">
        하나님이 주신 달란트, 지금 바로 길을 찾아보세요.
      </h2>
      <p class="text-slate-600 font-medium">
        **테스트 4문항** · 약 1분 · 결과는 참고용입니다. 말씀과 기도로 분별하세요.
      </p>

      <div class="grid sm:grid-cols-4 gap-4">
        <label class="block text-sm font-medium text-slate-700">이름(선택)
          <input id="inp-name" class="mt-1 w-full rounded-lg border-slate-300 focus:border-violet-600 focus:ring-violet-600 transition duration-150" placeholder="선생님"/>
        </label>

        <label class="block text-sm font-medium text-slate-700">성별 <span class="text-rose-600">*</span>
          <select id="inp-gender" class="mt-1 w-full rounded-lg border-slate-300 focus:border-violet-600 focus:ring-violet-600 transition duration-150" required>
            <option value="" selected disabled>선택하세요</option>
            <option>남성</option>
            <option>여성</option>
            <option>기타</option>
          </select>
        </label>

        <label class="block text-sm font-medium text-slate-700">연령 <span class="text-rose-600">*</span>
          <select id="inp-age" class="mt-1 w-full rounded-lg border-slate-300 focus:border-violet-600 focus:ring-violet-600 transition duration-150" required>
            <option value="" selected disabled>선택하세요</option>
            <option value="10~19세">10~19세</option>
            <option value="20~29세">20~29세</option>
            <option value="30~39세">30~39세</option>
            <option value="40~49세">40~49세</option>
            <option value="50~59세">50~59세</option>
            <option value="60~69세">60~69세</option>
            <option value="70~79세">70~79세</option>
            <option value="80~89세">80~89세</option>
            <option value="90~99세">90~99세</option>
            <option value="100세 이상">100세 이상</option>
          </select>
        </label>

        <label class="block text-sm font-medium text-slate-700">지역(선택)
          <select id="inp-region" class="mt-1 w-full rounded-lg border-slate-300 focus:border-violet-600 focus:ring-violet-600 transition duration-150">
            <option value="" selected>선택하세요</option>
            <option>서울</option><option>부산</option><option>대구</option><option>인천</option>
            <option>광주</option><option>대전</option><option>울산</option><option>세종</option>
            <option>경기</option><option>강원</option><option>충북</option><option>충남</option>
            <option>전북</option><option>전남</option><option>경북</option><option>경남</option>
            <option>제주</option><option>해외</option><option>기타</option>
          </select>
        </label>
      </div>

      <div class="rounded-xl border border-violet-200 bg-violet-50/60 p-4 shadow-sm">
        <p class="text-sm text-slate-700 leading-6">
          본 검사는 은사·성향 탐색을 위한 **참고용**입니다. 결과는 신학적 판단과 목회적 상담을 대체하지 않습니다.
          연구·서비스 개선을 위해 **익명 통계**로 활용될 수 있으며, 개인 식별 정보는 수집하지 않습니다.
        </p>
        <label class="mt-3 inline-flex items-center gap-2 text-sm font-medium text-slate-700 cursor-pointer">
          <input id="consent" type="checkbox" class="h-4 w-4 text-violet-600 border-gray-300 rounded focus:ring-violet-500">
          <span>위 내용을 이해하고 동의합니다.</span>
        </label>
      </div>

      <div class="flex flex-wrap gap-4">
        <button id="btn-start" type="button" class="px-6 py-3 rounded-xl bg-violet-700 text-white font-bold text-lg shadow-md hover:bg-violet-800 transition duration-150 btn-disabled">
          검사 시작하기
        </button>
        <button id="btn-clear" type="button" class="px-6 py-3 rounded-xl border border-rose-400 text-rose-700 font-semibold hover:bg-rose-50 transition duration-150">
          초기화
        </button>
      </div>
    </div>
  </section>

  <section id="screen-quiz" class="hidden mt-8 bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-8 sm:p-12">
    <div class="mb-6">
      <div class="flex items-center justify-between text-sm text-slate-600 mb-2 font-medium">
        <span id="progress-text">0 / 4 (0%)</span>
      </div>
      <div class="w-full bg-slate-200 rounded-full h-2">
        <div id="progress-bar" class="h-2 rounded-full bg-violet-600 transition-all duration-300" style="width:0%"></div>
      </div>
    </div>

    <div>
      <h3 id="q-title" class="text-xl sm:text-2xl font-bold mb-6 text-slate-800">문항 제목</h3>
      <div id="choices" class="space-y-4"></div>
    </div>

    <div class="mt-8 flex items-center justify-between">
      <button id="btn-prev" type="button" class="px-5 py-2.5 rounded-lg border border-slate-300 text-slate-700 font-medium hover:bg-white/80 transition duration-150">이전</button>
      <button id="btn-next" type="button" class="px-6 py-3 rounded-lg bg-violet-700 text-white font-semibold shadow-md hover:bg-violet-800 transition duration-150">다음</button>
    </div>
  </section>

  <section id="screen-result" class="hidden mt-8">
    <div id="result-card" class="bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl p-8 sm:p-12">
      <div class="result-header flex items-start justify-between flex-wrap gap-4">
        <div class="grow">
          <h3 class="text-3xl font-extrabold mb-1 text-slate-800">나의 달란트 조합</h3>
          <p id="result-sub-info" class="text-base text-slate-600 font-medium">
            </p>
        </div>
        <button id="btn-download" type="button" class="px-4 py-2 rounded-lg border border-slate-300 text-slate-700 font-medium hover:bg-slate-50 transition duration-150">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block mr-1" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L10 11.586l1.293-1.293a1 1 0 111.414 1.414l-2 2a1 1 0 01-1.414 0l-2-2a1 1 0 010-1.414z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v7a1 1 0 11-2 0V3a1 1 0 011-1z" clip-rule="evenodd"/></svg>
          PDF 저장
        </button>
      </div>

      <div id="top3" class="mt-4"></div>
      <div class="mt-10">
        <h4 class="text-xl font-bold mb-4 text-slate-800">세부 은사 점수</h4>
        <div id="score-table" class="grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm">
          </div>
      </div>


      <div class="mt-6 flex justify-center gap-3">
        <button id="btn-retry" type="button" class="px-5 py-3 rounded-xl border border-slate-300 text-slate-700 font-medium hover:bg-slate-50/60 transition duration-150">
          다시 검사
        </button>
      </div>
    </div>
  </section>
</main>

<script>
/* ===== 헬퍼 ===== */
const $ = (s)=>document.querySelector(s);

/* ===== 설정 ===== */
const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbweaLgXpR26lSOEHxn-9ys9UdJLU8liAsW3y9KYNEaTUu3mjZwruK_lBHJxiuTxB-E/exec';

/* ===== 유형 정의(상위 8영역) - 그대로 유지 ===== */
const TYPES = [
  { key:'L',  name:'리더십/조직' },
  { key:'C',  name:'돌봄/상담/자비' },
  { key:'S',  name:'섬김/봉사' },
  { key:'W',  name:'예배/예술' },
  { key:'T',  name:'가르침/지식' },
  { key:'M',  name:'전도/선교/사회' },
  { key:'P',  name:'기도/영성' },
  { key:'R',  name:'창의/혁신' }
];

/* ===== 응답 척도 - 그대로 유지 ===== */
const SCALE_LABELS = ['전혀 아니다','아니다','보통이다','그렇다','매우 그렇다'];

/* ===== 기본검사 4문항 (리더십 영역만 유지) ===== */
const QUESTIONS = [
  "새로운 모임(ex. 팀플, 새터)에 가면, 어색한 분위기를 깨고 내가 대화 주제를 던지는 편이다.",
  "'요즘 힘들다'는 친구의 말에 잔소리보다 '너의 마음'을 먼저 읽어주고 공감하는 것이 쉽다.",
  "문제 상황이 생기면 '왜'보다는 '어떻게 해결할지'에 대한 효율적인 아이디어가 바로 떠오른다.",
  "남들이 꺼리는 힘든 교회 봉사(ex. 화장실 청소, 무거운 짐 나르기)를 맡아도 기쁘게 완주한다.",
  "음악, 미술, 영상, 춤 등 뭔가 '예술적인 것'으로 나의 감정이나 신앙을 표현하는 것을 즐긴다.",
  "가족이나 친구, 혹은 공동체의 어려운 상황을 들으면, 그들을 위해 간절히 기도하게 된다.",
  "무대 위의 화려함보다, 아무도 모르게 묵묵히 준비하고 뒷정리하는 일에 더 의미를 느낀다.",
  "'총무'나 '조장'처럼 사람들을 모으고, 계획대로 일이 돌아가게 만드는 역할이 나에게 잘 맞는다.",
  "소수의 친구나 동생들과 깊은 관계를 맺고, 그들의 삶을 꾸준히 돌보는 일을 즐긴다.",
  "돈 관리, 장부 정리, 시설 문제 해결 같은 실무적인 'K-직장인' 같은 일들을 꼼꼼하게 처리할 수 있다.",
  "나의 특별한 기술(ex. 코딩, 디자인, 베이킹 등)을 교회 사역이나 이웃 섬김에 쓰고 싶다.",
  "아무도 시작하지 않은 새로운 사역이나 프로젝트를 '일단 해보자!' 하고 추진하는 것이 짜릿하다.",
  "친구가 자기 고민을 털어놓을 때, 조언보다 '경청'하는 것만으로도 충분히 편안하다.",
  "단순하지만 꼭 필요한 봉사(ex. 환경 미화, 배식, 주차)를 묵묵히 잘 해낸다는 평가를 받는다.",
  "뉴스나 사회 문제에서 소외된 계층(ex. 독거노인, 장애인, 난민) 이야기가 나오면 마음이 뜨거워진다.",
  "매번 똑같은 일보다는 새롭고 예측 불가능한 도전을 통해 성장하고 싶다.",
  "혼자서 완벽하게 하는 것보다, 여러 사람과 '함께' 땀 흘리며 결과물을 만드는 게 더 재미있다.",
  "말하지 않아도 상대방의 기분이나 미묘한 감정 변화를 빠르게 알아차리는 편이다.",
  "복잡한 상황을 표나 그래프, 논리적인 순서로 정리하여 해결해야 직성이 풀린다.",
  "성경이나 특정 주제에 대해 깊이 파고들어 새로운 지식이나 기술을 배우는 것을 진심으로 즐긴다.",
  "'나의 신앙을 다른 사람에게 전해야 한다'는 부담감보다 '기쁨'이 더 크고, 실제로 노력한다.",
  "찬양팀에서 싱어, 밴드, 율동 등으로 다른 사람의 예배를 돕는 역할에 열정이 있다.",
  "기도하는 중에 하나님이 일하심(ex. 응답, 문제 해결)을 특별히 강하게 경험한 적이 있다.",
  "'나의 용돈/수입을 어떻게 나눌까'를 고민하며, 구체적인 헌금이나 후원에 기쁨을 느낀다.",
  "공동체 사이에 갈등이 생겼을 때, 내가 중재해서 화해를 이끌어내는 능력이 있다.",
  "내가 아는 지식이나 경험을 다른 사람에게 '이해하기 쉽게' 설명해주거나 가르치는 일을 좋아한다.",
  "'늘 하던 방식' 대신 '더 효율적이고 획기적인' 아이디어를 내고, 실행까지 밀어붙인다.",
  "몸이 아프거나 마음이 힘든 사람에게 가장 먼저 다가가 실질적인 도움을 주려는 마음이 강하다.",
  "복잡한 신학적 진리나 성경의 깊은 내용을 탐구하고 정리하는 데서 오는 만족감이 크다.",
  "공동체가 어려울 때, '괜찮아, 우리 함께 다시 해보자!'라며 힘을 북돋아주는 역할을 한다.",
  "사람들과 만나 대화할수록 배터리가 충전되는 느낌이다.",
  "결과가 조금 아쉽더라도, 목표를 향해 노력했던 '과정'에서 더 많이 배운다고 생각한다.",
  "맡은 일은 어떻게든 '내 선에서' 완벽하게 책임지고 마무리해야 마음이 편하다.",
  "낯선 곳이나 새로운 환경(ex. 전학, 인턴, 군대)에도 빠르게 적응하고 금방 내 자리를 찾는다.",
  "내 생각이나 관점을 SNS, 발표, 대화 등을 통해 다른 사람들에게 '잘 전달한다'는 평을 듣는다.",
  "계획대로 안 되어도 스트레스받기보다, 상황에 맞춰 유연하게 대처하는 것이 더 편하고 능숙하다.",
  "하루 일과나 생활 방식이 규칙적이고 예측 가능할 때 심리적으로 안정감을 느낀다.",
  "안정된 일상보다는 새로운 변화와 도전을 통해 '성장하는 맛'을 즐긴다.",
  "친구들과 함께 팀을 짜서 소통하고 협력하는 활동(ex. 팀플, 공동체 사역)이 훨씬 재미있다.",
  "혼자 조용히 깊이 생각하거나 작업할 때 가장 집중이 잘되고 효율적이다.",
  "나만의 독특한 아이디어나 감각을 그림, 디자인, 글쓰기 등으로 표현할 때 즐거움을 느낀다.",
  "데이터를 분석하고 논리적으로 정리해서 깔끔하게 설명하는 능력이 나에게 있다고 생각한다.",
  "나의 기쁨, 슬픔, 화 같은 감정을 숨기지 않고 솔직하게 표현하는 편이다.",
  "하루를 돌아보며 조용히 묵상하거나 내면의 소리를 듣는 시간을 중요하게 여긴다.",
  "힘들거나 스트레스받을 때, 몸을 움직이는 활동(ex. 운동, 산책)으로 푸는 것이 효과적이다.",
  "직업을 고를 때, 연봉(돈)보다 그 일이 주는 '의미와 보람'이 훨씬 더 중요하다.",
  "내가 가진 강점이나 재능(Talent)을 활용해서 다른 사람에게 실질적인 도움을 주고 싶다.",
  "환경 문제, 청소년 인권, 빈곤 등 사회적인 이슈에 적극적으로 관심을 가지고 참여하려 한다.",
  "학원 선생님, 코치, 멘토처럼 사람들을 가르치고 성장하도록 지도하는 일이 잘 맞는다.",
  "사회 복지, 상담, 간호처럼 다른 사람을 돕고 돌보는 분야에서 일하는 것을 진지하게 고려해 본 적이 있다.",
  "유튜브, 디자인, 영화, 음악 등 미디어나 예술을 통해 메시지를 전달하는 직업에 끌린다.",
  "조직을 효율적으로 관리하고, 자원(사람/물질)을 배분하는 경영/행정 쪽에 흥미가 있다.",
  "AI, 데이터, 코딩, 과학 기술 같은 분야에 흥미를 느끼고, 이 분야로 하나님을 섬기고 싶다.",
  "나만의 아이디어를 실현하여 새로운 서비스나 제품을 만드는 '창업'에 도전하고 싶다.",
  "직업을 선택할 때, '나의 신앙과 가치관'에 어긋나지 않는지를 가장 먼저 체크한다.",
  "자유롭게 움직이며 사람들과 끊임없이 소통하고 협력해야 하는 직업이 나에게 더 잘 맞는다.",
  "혼자 몰입해서 연구하거나 정밀하게 제작하는 등 '나만의 시간'이 필요한 직업이 잘 맞는다.",
  "전문적인 상담, 심리 치료, 라이프 코칭 등을 통해 사람의 내면을 회복시키는 일을 하고 싶다.",
  "외국에서 일하거나, 글로벌 비즈니스, 해외 선교 등 국제적인 경험이 있는 직업에 관심이 많다.",
  "어떤 직업을 갖든지, 내가 일하는 그곳이 '하나님 나라를 확장하는 통로'가 될 수 있다고 확신한다."
];

/* ===== 역문항 인덱스(1-base) - 해당 없음 ===== */
const REVERSE = new Set([]);

/* ===== 문항→영역 매핑 (4문항에 맞게 수정) ===== */
const MAP = {
  L:[1,2,3,4], // 1~4번 문항이 리더십(L)에 해당
  C:[], S:[], W:[], T:[], M:[], P:[], R:[] // 나머지 영역은 문항 0개
};

/* ===== 56가지 조합 설명 및 사역 예시 (추가됨) ===== */
const COMBO = {
  "C+L+M": {title:"새신자 정착 개척자", desc:"돌봄(<span class='combo-key-highlight'>C</span>) 기반의 리더십(<span class='combo-key-highlight'>L</span>)으로 복음 전파(<span class='combo-key-highlight'>M</span>)를 체계화합니다.", examples:["새신자 양육 그룹장","전도팀 리더","국내외 아웃리치 사역 기획 및 인솔","위기 개척교회 컨설팅","관계 전도 훈련 리더"]},
  "C+L+P": {title:"영적 돌봄 리더", desc:"기도(<span class='combo-key-highlight'>P</span>)와 돌봄(<span class='combo-key-highlight'>C</span>)으로 공동체 리더십(<span class='combo-key-highlight'>L</span>)의 영적 깊이를 더합니다.", examples:["중보기도팀 리더","심방/소그룹 리더","영적 돌봄이 필요한 성도 관리","말씀 묵상 모임 리더","금요철야 또는 새벽기도회 기획"]},
  "C+L+R": {title:"공동체 혁신 코치", desc:"창의성(<span class='combo-key-highlight'>R</span>)을 활용한 리더십(<span class='combo-key-highlight'>L</span>)으로 돌봄(<span class='combo-key-highlight'>C</span>) 기반의 새로운 공동체를 만듭니다.", examples:["청년부/교육부 비전 수립 및 혁신","교회 내 갈등 조정 코치","새로운 소그룹 모델 개발","교회의 새 대안학교 설립 준비","소규모 공동체 실험"]},
  "C+L+S": {title:"실천적 돌봄 리더", desc:"조직력(<span class='combo-key-highlight'>L</span>)과 돌봄(<span class='combo-key-highlight'>C</span>), 섬김(<span class='combo-key-highlight'>S</span>)으로 공동체의 필요를 채웁니다.", examples:["목회행정 총괄","구제 사역팀 리더","봉사자 훈련 및 배치","교회 차량/식사 봉사 조직화","새가족 정착 지원팀 리더"]},
  "C+L+T": {title:"양육 전문가 리더", desc:"가르침(<span class='combo-key-highlight'>T</span>)과 돌봄(<span class='combo-key-highlight'>C</span>)에 리더십(<span class='combo-key-highlight'>L</span>)을 더하여 제자 훈련을 이끌어갑니다.", examples:["제자훈련 리더","청년/장년 성경공부 인도","양육팀장","교사 훈련 및 관리","주중 성경공부 프로그램 개설"]},
  "C+L+W": {title:"예배 공동체 디렉터", desc:"예배(<span class='combo-key-highlight'>W</span>) 중심의 공동체를 리드(<span class='combo-key-highlight'>L</span>)하며 성도들을 돌봅니다(<span class='combo-key-highlight'>C</span>).", examples:["예배팀 리더 (싱어/밴드 관리)","예배 후 상담/기도 부스 운영","특별 새벽기도회 기획","예배 공간 디자인 개선","예배 공동체 리더"]},
  "C+M+P": {title:"중보적 복음 전달자", desc:"전도(<span class='combo-key-highlight'>M</span>) 대상을 위해 기도(<span class='combo-key-highlight'>P</span>)하며 따뜻한 돌봄(<span class='combo-key-highlight'>C</span>)으로 다가갑니다.", examples:["기도 전도팀","위로와 중보가 필요한 성도를 위한 전도","해외 선교사 영적/정서적 지원","전도 대상자를 위한 특별 기도회 운영","병원/양로원 전도"]},
  "C+M+R": {title:"창의적 관계 전도자", desc:"창의성(<span class='combo-key-highlight'>R</span>)을 활용해 전도(<span class='combo-key-highlight'>M</span>)하며 관계 속에서 돌봄(<span class='combo-key-highlight'>C</span>)을 실천합니다.", examples:["교회 SNS/미디어 콘텐츠 기획","복음적 웹툰/영상 제작","창의적 관계 전도 방법 개발","문화 선교팀 활동","청년 대상 공감/위로 콘텐츠 제작"]},
  "C+M+S": {title:"지역사회 봉사 전도자", desc:"섬김(<span class='combo-key-highlight'>S</span>)과 돌봄(<span class='combo-key-highlight'>C</span>)을 통해 지역사회에 복음(<span class='combo-key-highlight'>M</span>)을 전달합니다.", examples:["지역사회 봉사를 통한 전도(도시락/반찬)","구제 활동 전도","노방 전도 및 실생활 필요 채우기","미자립교회 물품 지원","선교 후원 활동"]},
  "C+M+T": {title:"복음주의 멘토", desc:"가르침(<span class='combo-key-highlight'>T</span>)과 돌봄(<span class='combo-key-highlight'>C</span>)을 통해 전도(<span class='combo-key-highlight'>M</span>) 대상자를 깊이 양육합니다.", examples:["알파 코스 리더","일대일 양육을 통한 전도","다문화 가정 언어 및 신앙 교육","복음주의 변증 훈련","전도 간증 및 스토리텔링"]},
  "C+M+W": {title:"문화적 위로 사역자", desc:"예배/문화(<span class='combo-key-highlight'>W</span>)를 통해 복음(<span class='combo-key-highlight'>M</span>)을 전하고 지친 영혼을 돌봅니다(<span class='combo-key-highlight'>C</span>).", examples:["전도 축제 예배 기획","찬양 집회 인솔 및 위로","문화 공연을 통한 선교","예배 후 초신자 환영 및 돌봄","찾아가는 예배 기획"]},
  "C+P+R": {title:"영적 성장 콘텐츠 개발자", desc:"창의성(<span class='combo-key-highlight'>R</span>)으로 기도(<span class='combo-key-highlight'>P</span>)와 영성을 개발하고 성도를 돌봅니다(<span class='combo-key-highlight'>C</span>).", examples:["영성 훈련 프로그램 혁신","기도 일기/기도 노트 제작","영적 성장 캠프 기획","개인 영성 코칭","창의적 중보 기도회 운영"]},
  "C+P+S": {title:"고난받는 자의 중보자", desc:"기도(<span class='combo-key-highlight'>P</span>)와 섬김(<span class='combo-key-highlight'>S</span>)으로 고통받는 이들을 돌봅니다(<span class='combo-key-highlight'>C</span>).", examples:["환자 방문 및 중보","고난받는 이들을 위한 봉사","교회 내 특별 심방팀","목회자 사모/자녀 지원","어려운 성도 심방 및 기도"]},
  "C+P+T": {title:"영성 교육 코치", desc:"기도(<span class='combo-key-highlight'>P</span>)를 기반으로 가르침(<span class='combo-key-highlight'>T</span>)을 통해 성도의 영성을 돌봅니다(<span class='combo-key-highlight'>C</span>).", examples:["소그룹 성경 교육 리더","큐티 나눔 모임 인도","기독교 세계관 교육","기도와 함께하는 심층적 제자훈련","사역자 영성 교육"]},
  "C+P+W": {title:"치유와 위로의 예배자", desc:"예배(<span class='combo-key-highlight'>W</span>)와 기도(<span class='combo-key-highlight'>P</span>)를 통해 지친 성도를 돌봅니다(<span class='combo-key-highlight'>C</span>).", examples:["치유 기도회 리더","영성 회복 집회 기획","예배 중 중보 기도 담당","찬양과 기도를 통한 돌봄","예배 전후 성도 쉼터 운영"]},
  "C+R+S": {title:"필요 중심의 섬김 혁신가", desc:"창의성(<span class='combo-key-highlight'>R</span>)을 발휘하여 성도의 필요에 맞춘 돌봄(<span class='combo-key-highlight'>C</span>)과 섬김(<span class='combo-key-highlight'>S</span>)을 제공합니다.", examples:["교회 공간 활용 혁신(북카페, 쉼터)","특별 행사 디자인 및 봉사","지역사회 연결 프로젝트","성도의 필요에 맞는 물품/시설 개선","섬김 아이디어 제안"]},
  "C+R+T": {title:"공감형 교육 콘텐츠 전문가", desc:"창의적(<span class='combo-key-highlight'>R</span>) 교수법으로 돌봄(<span class='combo-key-highlight'>C</span>) 중심의 교육(<span class='combo-key-highlight'>T</span>)을 진행합니다.", examples:["흥미로운 교리 교육 콘텐츠 제작","그림/영상 등을 활용한 공과 학습","청소년 진로 상담 및 코칭","독서 모임/지식 나눔을 통한 돌봄","교재 개발"]},
  "C+R+W": {title:"미디어 아트 돌봄 사역자", desc:"예배/예술(<span class='combo-key-highlight'>W</span>)과 창의성(<span class='combo-key-highlight'>R</span>)을 활용하여 성도를 돌봅니다(<span class='combo-key-highlight'>C</span>).", examples:["미디어 아트 예배 기획","청년 예배 포맷 혁신","예배 공간 예술적 디자인","성탄/부활절 절기 예배 디자인","영감을 주는 예배자 양성"]},
  "C+S+T": {title:"실무 멘토링 코치", desc:"실무 섬김(<span class='combo-key-highlight'>S</span>)과 돌봄(<span class='combo-key-highlight'>C</span>)에 지식(<span class='combo-key-highlight'>T</span>)으로 힘을 보탭니다.", examples:["주일학교 교사","식사 봉사팀 리더","지역 아동센터 학습 지도 봉사","교회 청소/정비와 함께하는 관계 섬김","멘토링 프로그램 운영"]},
  "C+S+W": {title:"환대와 봉사의 예배 환경 조성자", desc:"섬김(<span class='combo-key-highlight'>S</span>)과 돌봄(<span class='combo-key-highlight'>C</span>)으로 예배(<span class='combo-key-highlight'>W</span>) 환경을 편안하게 조성합니다.", examples:["헌금위원 및 안내위원","주방 봉사 및 식사 교제 담당","환대 사역팀","교회 시설 유지/보수를 통한 섬김","예배 전후 성도 섬기기"]},
  "C+T+W": {title:"예배 교육 멘토", desc:"가르침(<span class='combo-key-highlight'>T</span>)을 통해 예배(<span class='combo-key-highlight'>W</span>)의 깊이를 더하고 성도들을 돌봅니다(<span class='combo-key-highlight'>C</span>).", examples:["예배의 본질 교육","예배 인도자/찬양팀 훈련","예배학/예전 교육","절기 교육","예배 후 말씀 나눔 인도"]},
  "L+M+P": {title:"전략적 선교 기도 리더", desc:"전도(<span class='combo-key-highlight'>M</span>)와 기도(<span class='combo-key-highlight'>P</span>)를 전략적 리더십(<span class='combo-key-highlight'>L</span>)으로 통합합니다.", examples:["전도팀 영적 리더","선교사 파송 및 관리","교구/구역 리더 기도 모임","전략적 중보기도 사역","해외 선교지 개척 인솔"]},
  "L+M+R": {title:"교회 부흥 마케터", desc:"창의성(<span class='combo-key-highlight'>R</span>)으로 전도/선교(<span class='combo-key-highlight'>M</span>) 전략을 리드(<span class='combo-key-highlight'>L</span>)합니다.", examples:["교회 미디어 전략 기획","새로운 교회 개척 모델 제시","온라인 플랫폼 통한 전도/선교","창의적 선교 헌금 캠페인","청년부 부흥 전략 수립"]},
  "L+M+S": {title:"실천적 선교 행정가", desc:"섬김(<span class='combo-key-highlight'>S</span>)과 전도(<span class='combo-key-highlight'>M</span>) 활동을 조직적 리더십(<span class='combo-key-highlight'>L</span>)으로 총괄합니다.", examples:["지역사회 선교 리더","이웃 초청 전도 행사 총괄","교회 밖 봉사팀 조직","전문인 선교 단체 조직화","재정/물품 지원 선교"]},
  "L+M+T": {title:"전도 훈련 시스템 구축자", desc:"전도(<span class='combo-key-highlight'>M</span>)와 가르침(<span class='combo-key-highlight'>T</span>)을 결합한 리더십(<span class='combo-key-highlight'>L</span>)으로 전도자를 양성합니다.", examples:["전도 훈련 프로그램 개발 및 인도","리더십 세미나 강사","새신자 집중 교육반 운영","기독교 세계관 전도 훈련","사영리 교육팀 리더"]},
  "L+M+W": {title:"복음 확산 예배 기획자", desc:"예배(<span class='combo-key-highlight'>W</span>)와 전도(<span class='combo-key-highlight'>M</span>)를 위한 행사를 리드(<span class='combo-key-highlight'>L</span>)합니다.", examples:["예배 기획 및 총괄","대형 집회/페스티벌 인솔","거리 찬양 전도팀 조직","지역 연합 집회 총괄","전도 예배 기획"]},
  "L+P+R": {title:"비전 기도 디자이너", desc:"기도(<span class='combo-key-highlight'>P</span>)와 리더십(<span class='combo-key-highlight'>L</span>)에 창의성(<span class='combo-key-highlight'>R</span>)을 더해 교회의 비전을 제시합니다.", examples:["교회 비전 기획 및 제시","기도실/공간 혁신","영적 지도력 개발 프로그램","창의적 기도 콘텐츠 제작","영성 중심의 리더십 훈련"]},
  "L+P+S": {title:"영적 권위의 봉사 리더", desc:"기도(<span class='combo-key-highlight'>P</span>)를 기반으로 섬김(<span class='combo-key-highlight'>S</span>) 사역을 리드(<span class='combo-key-highlight'>L</span>)하며 영적 권위를 세웁니다.", examples:["교회 재정/시설 관리팀 영적 리더","봉사자 영성 관리","구역장/순장 기도회 리더","교회 운영위원회","봉사 사역의 영적 방향 제시"]},
  "L+P+T": {title:"영성 중심의 멘토 리더", desc:"기도(<span class='combo-key-highlight'>P</span>)와 가르침(<span class='combo-key-highlight'>T</span>)을 통해 조직 리더(<span class='combo-key-highlight'>L</span>)를 세웁니다.", examples:["핵심 제자훈련 리더","리더십 개발 교육","영성 수련회 강사","권사/장로 교육","조직 내 멘토링 시스템 구축"]},
  "L+P+W": {title:"영감 있는 예배 인도자", desc:"예배(<span class='combo-key-highlight'>W</span>)와 기도(<span class='combo-key-highlight'>P</span>)를 통해 공동체를 리드(<span class='combo-key-highlight'>L</span>)하는 영적 지도자입니다.", examples:["예배 인도자(Worship Leader)","예배 기획/행정 총괄","예배 중보팀 조직","예배자 훈련 시스템","영적 권위 있는 예배 인도"]},
  "L+R+S": {title:"시설/행정 혁신 리더", desc:"창의성(<span class='combo-key-highlight'>R</span>)으로 섬김(<span class='combo-key-highlight'>S</span>)과 행정(<span class='combo-key-highlight'>L</span>)을 효율화합니다.", examples:["교회 시설 리모델링 총괄","교회 로고/브랜드 디자인","봉사 시스템 디지털화","다음 세대 공간 디자인","교회 환경 미화 총괄"]},
  "L+R+T": {title:"교육 시스템 설계자", desc:"창의적(<span class='combo-key-highlight'>R</span>) 관점으로 가르침(<span class='combo-key-highlight'>T</span>)과 교육 행정(<span class='combo-key-highlight'>L</span>) 시스템을 혁신합니다.", examples:["교육 커리큘럼 혁신","교재/콘텐츠 개발팀 리더","기독교 인문학 강좌 개설","미디어 교육 플랫폼 구축","청년 창업/진로 코칭 리더"]},
  "L+R+W": {title:"창조적 예배 연출가", desc:"창의성(<span class='combo-key-highlight'>R</span>)을 발휘하여 예배(<span class='combo-key-highlight'>W</span>)를 리드(<span class='combo-key-highlight'>L</span>)하며 예술적 영감을 불어넣습니다.", examples:["창조적 예배 기획(테마/구성)","미디어팀 조직 및 관리","예배당 무대 디자인 총괄","문화 사역팀 리더","절기별 특별 예배 연출"]},
  "L+S+T": {title:"행정/교육 총괄자", desc:"섬김(<span class='combo-key-highlight'>S</span>)과 가르침(<span class='combo-key-highlight'>T</span>)의 사역을 조직적으로 리드(<span class='combo-key-highlight'>L</span>)합니다.", examples:["교회 학교 교장/부장","교회 행정 간사 및 시스템 관리","새가족 교육 및 봉사 연결","교회 자원 봉사자 교육","전문 직업인을 위한 훈련"]},
  "L+S+W": {title:"예배 봉사 시스템 리더", desc:"섬김(<span class='combo-key-highlight'>S</span>)을 조직화(<span class='combo-key-highlight'>L</span>)하여 예배(<span class='combo-key-highlight'>W</span>) 환경을 최적화합니다.", examples:["예배 안내팀/주차팀 총괄","성찬식 준비/진행","교회 시설 관리 및 예배 환경 조성","예배 봉사팀 운영","다음 세대 예배 봉사 훈련"]},
  "L+T+W": {title:"예배자 양육 디렉터", desc:"예배(<span class='combo-key-highlight'>W</span>)의 원리를 가르치고(<span class='combo-key-highlight'>T</span>) 예배자를 조직적(<span class='combo-key-highlight'>L</span>)으로 훈련합니다.", examples:["예배 인도자 훈련","찬양팀 영적 지도","예배의 원리 교육","예배학 세미나","주일학교 예배 교육 커리큘럼 개발"]},
  "M+P+R": {title:"선교 콘텐츠 전략가", desc:"창의성(<span class='combo-key-highlight'>R</span>)을 활용해 기도(<span class='combo-key-highlight'>P</span>)와 선교(<span class='combo-key-highlight'>M</span>)를 연결하는 콘텐츠를 만듭니다.", examples:["전도용 미디어 콘텐츠 기획","복음 제시를 위한 새로운 기도 운동","선교사 동원 창의적 캠페인","온라인 전도 플랫폼 개발","선교 관련 기도 앱/툴 개발"]},
  "M+P+S": {title:"구호 선교 중보자", desc:"기도(<span class='combo-key-highlight'>P</span>)와 섬김(<span class='combo-key-highlight'>S</span>)을 통해 전도/선교(<span class='combo-key-highlight'>M</span>) 사역의 영적 토대를 만듭니다.", examples:["노숙인/취약계층을 위한 기도와 봉사","재해 구호 활동 참여","선교지 구호 물품 정리 및 발송","전도 대상자를 위한 기도와 식사 제공","지역 봉사 연합"]},
  "M+P+T": {title:"선교 교육 훈련가", desc:"기도(<span class='combo-key-highlight'>P</span>)로 준비하며 전도(<span class='combo-key-highlight'>M</span>) 대상자를 가르치는(<span class='combo-key-highlight'>T</span>) 사역에 집중합니다.", examples:["전도 훈련을 위한 심층 성경 공부","이단 대처 교육 및 기도회","선교지 현지인 사역자 훈련","복음주의 변증 강좌 개설","전도 소그룹 운영"]},
  "M+P+W": {title:"전도 부흥을 위한 예배자", desc:"예배(<span class='combo-key-highlight'>W</span>)와 기도(<span class='combo-key-highlight'>P</span>)를 통해 전도(<span class='combo-key-highlight'>M</span>)의 문을 엽니다.", examples:["전도 대상자를 위한 특별 예배(열린 예배)","찬양을 통한 중보기도","선교지 영성 훈련","지역 사회 연합 기도회 기획","예배 전도단 운영"]},
  "M+R+S": {title:"문화 봉사 선교 기획자", desc:"창의성(<span class='combo-key-highlight'>R</span>)과 섬김(<span class='combo-key-highlight'>S</span>)을 통해 효과적인 전도/선교(<span class='combo-key-highlight'>M</span>) 활동을 기획합니다.", examples:["지역 특성에 맞는 창의적 봉사 전도","문화 센터 운영을 통한 접촉","SNS를 통한 선교/봉사 활동 홍보","지역 사회 연합 프로젝트","교회 인근 환경 미화 캠페인"]},
  "M+R+T": {title:"복음 변증 콘텐츠 제작자", desc:"창의적(<span class='combo-key-highlight'>R</span>) 방법으로 복음(<span class='combo-key-highlight'>M</span>)을 가르치는(<span class='combo-key-highlight'>T</span>) 자료를 만듭니다.", examples:["복음을 쉽게 이해시키는 시각 자료 개발","기독교 진리를 현대적으로 설명하는 강좌","창의적 선교 자료 제작","복음 제시 템플릿 개발","일대일 전도 콘텐츠 개발"]},
  "M+R+W": {title:"문화 선교 콘텐츠 디자이너", desc:"창의(<span class='combo-key-highlight'>R</span>)로 선교(<span class='combo-key-highlight'>M</span>)용 예배/문화(<span class='combo-key-highlight'>W</span>) 콘텐츠를 만듭니다.", examples:["미디어 예배를 통한 선교","버스킹/찬양 공연 전도","선교 영화/드라마 제작","문화적 코드가 담긴 예배 기획","선교지 특화 예배 개발"]},
  "M+S+T": {title:"실천적 선교 교육가", desc:"섬김(<span class='combo-key-highlight'>S</span>)을 통해 전도(<span class='combo-key-highlight'>M</span>)하며 실질적인 가르침(<span class='combo-key-highlight'>T</span>)을 제공합니다.", examples:["지역 사회 교육 봉사 (공부방, 멘토링)","봉사를 통한 전도 간증 훈련","선교 바자회 기획 및 교육","선교지 자립 지원 교육","직업 훈련 통한 전도"]},
  "M+S+W": {title:"지역 초청 예배 봉사자", desc:"섬김(<span class='combo-key-highlight'>S</span>)과 예배(<span class='combo-key-highlight'>W</span>)를 통해 지역 사회 전도(<span class='combo-key-highlight'>M</span>)에 기여합니다.", examples:["지역 사회 초청 찬양 예배","절기 이웃 초청 행사 봉사","해외 선교지 건축/기술 봉사","복음 전달 목적의 찬양/율동팀","봉사 현장에서의 예배"]},
  "M+T+W": {title:"예배 중심의 전도 강사", desc:"예배(<span class='combo-key-highlight'>W</span>)와 가르침(<span class='combo-key-highlight'>T</span>)을 활용하여 복음(<span class='combo-key-highlight'>M</span>)을 제시하고 훈련합니다.", examples:["예배를 통한 복음 제시 훈련","강해 설교를 통한 전도","예배 후 초신자 교육","예배자 성경 공부 모임","성경적 세계관 전도 훈련"]},
  "P+R+S": {title:"기도 환경 디자이너", desc:"창의성(<span class='combo-key-highlight'>R</span>)과 섬김(<span class='combo-key-highlight'>S</span>)을 발휘하여 영감 있는 기도(<span class='combo-key-highlight'>P</span>) 환경을 조성합니다.", examples:["교회의 기도 공간 디자인","봉사 활동 중 영감 있는 기도문 작성","성도들의 기도 제목을 창의적으로 정리","기도 요청 자동화 시스템 구축","창의적 섬김과 중보"]},
  "P+R+T": {title:"영적 지식 콘텐츠 창조자", desc:"기도(<span class='combo-key-highlight'>P</span>)를 바탕으로 창의적(<span class='combo-key-highlight'>R</span>) 교육(<span class='combo-key-highlight'>T</span>) 콘텐츠를 만듭니다.", examples:["창의적 교리/성경 학습 콘텐츠 제작","기도학교 커리큘럼 개발","영적 지식 전수를 위한 미디어 활용","영성 분야 전문 강사","기도문/찬양 작곡"]},
  "P+R+W": {title:"영감 있는 예배 연출자", desc:"창의성(<span class='combo-key-highlight'>R</span>)과 기도(<span class='combo-key-highlight'>P</span>)를 통해 예배(<span class='combo-key-highlight'>W</span>)의 영적 깊이를 더합니다.", examples:["영적 부흥을 위한 특별 기도회 연출","예배 분위기 개선 및 몰입도 향상","예배 중 영감 있는 비주얼/아트 사용","창의적 찬양과 경배","예배자 영성 코칭"]},
  "P+S+T": {title:"영성 관리 멘토", desc:"기도(<span class='combo-key-highlight'>P</span>)와 섬김(<span class='combo-key-highlight'>S</span>)을 통해 사역자들을 가르치고(<span class='combo-key-highlight'>T</span>) 지원합니다.", examples:["영적 리더 멘토링","중보기도팀 훈련 및 관리","권사/집사 영성 교육","사역자를 위한 기도 훈련","봉사자의 영적 상태 돌봄"]},
  "P+S+W": {title:"영적 분위기 섬김자", desc:"예배(<span class='combo-key-highlight'>W</span>)와 섬김(<span class='combo-key-highlight'>S</span>)을 위해 기도(<span class='combo-key-highlight'>P</span>)하며 봉사합니다.", examples:["예배 전 중보 기도회","예배 후 성도들의 개인 기도 제목 섬김","헌금 위원 영적 준비","성도들을 위한 축복 기도 사역","찬양팀 영성 지원"]},
  "P+T+W": {title:"말씀/기도 훈련 전문가", desc:"예배(<span class='combo-key-highlight'>W</span>)와 가르침(<span class='combo-key-highlight'>T</span>)에 기도(<span class='combo-key-highlight'>P</span>)를 통합하여 성도를 훈련합니다.", examples:["예배 전후 영적 준비 모임 인도","말씀과 기도의 균형 있는 강조","예배학적 관점에서 기도 훈련","예배를 위한 신학적 교육","예배 영적 분위기 조성"]},
  "R+S+T": {title:"교육 환경 개선 설계자", desc:"창의성(<span class='combo-key-highlight'>R</span>)과 섬김(<span class='combo-key-highlight'>S</span>)을 통해 교육(<span class='combo-key-highlight'>T</span>) 환경을 혁신합니다.", examples:["교회 자료 디자인 및 교육","주일학교 교재/교구 제작","전문 기술 교육 봉사","교회 내 새로운 교육 시스템 개발","젊은 세대 맞춤형 교육 환경 구축"]},
  "R+S+W": {title:"예술적 섬김 연출가", desc:"창의성(<span class='combo-key-highlight'>R</span>)과 섬김(<span class='combo-key-highlight'>S</span>)을 통해 예배(<span class='combo-key-highlight'>W</span>)에 예술적 요소를 더합니다.", examples:["교회 환경 디자인 봉사","예배 중 시각/청각적 요소 지원","무대 설치/음향/조명 관리","절기별 특별 무대 장치 제작","예배팀 복장/스타일링 조언"]},
  "R+T+W": {title:"미디어/예술 교육 전문가", desc:"창의성(<span class='combo-key-highlight'>R</span>)을 활용하여 예배(<span class='combo-key-highlight'>W</span>) 관련 지식(<span class='combo-key-highlight'>T</span>)을 교육합니다.", examples:["예배 디자인 교육","미디어 활용 설교/강의","교회 웹사이트/앱 개발 및 교육","예배 콘텐츠 개발(영상, 음악)","시청각 교육 전문가"]},
  "S+T+W": {title:"실제적 예배 도우미", desc:"섬김(<span class='combo-key-highlight'>S</span>)을 통해 예배(<span class='combo-key-highlight'>W</span>)를 돕고 관련된 지식(<span class='combo-key-highlight'>T</span>)을 나눕니다.", examples:["예배 안내 및 질서 교육","교회 식사 봉사와 신앙 나눔","주일학교 공과 지도","성경 통독반 리더","교회 행사 진행 및 교육"]}
};

/* ===== 상태 및 이벤트 핸들러 - 그대로 유지 ===== */
let state = { i:0, answers:Array(QUESTIONS.length).fill(null), name:'', gender:'', age:'', region:'', rt:Array(QUESTIONS.length).fill(0) };
let qStart = 0;

/* ===== 시작 버튼 활성화 & 이벤트 등록 - 그대로 유지 ===== */
function toggleStartBtn(){
  const ok = $('#consent').checked && !!$('#inp-gender').value && !!$('#inp-age').value;
  $('#btn-start').classList.toggle('btn-disabled', !ok);
}
document.addEventListener('DOMContentLoaded', ()=>{
  toggleStartBtn();
  $('#consent').addEventListener('change', toggleStartBtn);
  $('#inp-gender').addEventListener('change', toggleStartBtn);
  $('#inp-age').addEventListener('change', toggleStartBtn);

  $('#btn-start').addEventListener('click', ()=>{
    if(!$('#consent').checked) return alert('동의가 필요합니다.');
    if(!$('#inp-gender').value) return alert('성별을 선택해 주세요.');
    if(!$('#inp-age').value) return alert('연령을 선택해 주세요.');

    state = {
      i:0,
      answers:Array(QUESTIONS.length).fill(null),
      name: ($('#inp-name').value||'').trim(),
      gender: $('#inp-gender').value,
      age: $('#inp-age').value,
      region: $('#inp-region').value || '',
      rt: Array(QUESTIONS.length).fill(0)
    };
    showQuiz();
  });

  $('#btn-clear').addEventListener('click', ()=>location.reload());
  $('#btn-prev').addEventListener('click', prev);
  $('#btn-next').addEventListener('click', next);
  $('#btn-retry').addEventListener('click', ()=>location.reload());
  $('#btn-download').addEventListener('click', ()=>{
    const target = $('#result-card');
    const opt = { margin:10, filename:`달란트로드_결과_${Date.now()}.pdf`, image:{type:'jpeg',quality:0.98}, html2pdf:{scale:2}, jsPDF:{unit:'mm',format:'a4',orientation:'portrait'} };
    html2pdf().from(target).set(opt).save();
  });
});

/* ===== 화면 전환 - 그대로 유지 ===== */
function showQuiz(){
  $('#screen-start').classList.add('hidden');
  $('#screen-quiz').classList.remove('hidden');
  $('#screen-result').classList.add('hidden');
  renderQuestion();
}
function showResult(){
  $('#screen-start').classList.add('hidden');
  $('#screen-quiz').classList.add('hidden');
  $('#screen-result').classList.remove('hidden');
  renderResult();
}

/* ===== 문항 렌더 - 그대로 유지 ===== */
function renderQuestion(){
  const i = state.i, q = QUESTIONS[i];
  $('#q-title').textContent = `Q${i+1}. ${q}`;
  const wrap = $('#choices'); wrap.innerHTML = '';

  SCALE_LABELS.forEach((txt, idx)=>{
    const val = idx+1, id = `q${i}_v${val}`;
    const checked = state.answers[i]===val ? 'checked' : '';
    wrap.insertAdjacentHTML('beforeend', `
      <div class="choice">
        <input class="peer hidden" type="radio" id="${id}" name="q${i}" value="${val}" ${checked}/>
        <label for="${id}" class="block rounded-xl border border-slate-300 p-3 cursor-pointer peer-checked:border-violet-700 transition duration-150">
          <span class="font-medium">${txt}</span>
        </label>
      </div>`);
  });

  const isLast = (i === QUESTIONS.length - 1);
  $('#btn-next').textContent = isLast ? '제출' : '다음';
  $('#btn-prev').disabled = (i===0);
  toggleNextBtn(!!state.answers[i]);

  document.querySelectorAll(`input[name="q${i}"]`).forEach(r=>{
    r.addEventListener('change', ()=>{
      state.answers[i] = Number(r.value);
      toggleNextBtn(true);
    });
  });

  const totalQuestions = QUESTIONS.length;
  const currentQ = i + 1;
  const pct = Math.round((currentQ)/totalQuestions*100);
  $('#progress-text').textContent = `${currentQ} / ${totalQuestions} (${pct}%)`;
  $('#progress-bar').style.width = `${pct}%`;

  qStart = performance.now();
}
function toggleNextBtn(enabled){ $('#btn-next').classList.toggle('btn-disabled', !enabled); }

/* ===== 점수 계산 (역문항 처리 포함) - 그대로 유지 ===== */
function calcScores(){
  const sums = {L:0,C:0,S:0,W:0,T:0,M:0,P:0,R:0};
  const counts = {L:0,C:0,S:0,W:0,T:0,M:0,P:0,R:0};
  Object.keys(MAP).forEach(k=>{
    MAP[k].forEach(n=>{
      let a = state.answers[n-1];
      if(a!=null){
        if(REVERSE.has(n)) a = 6 - a;
        sums[k]+=a; counts[k]++;
      }
    });
  });
  return Object.keys(sums).map(k=>{
    const type = TYPES.find(t=>t.key===k);
    const avg = counts[k] ? sums[k]/counts[k] : 0;
    return { key:k, name:type.name, sum:sums[k], n:counts[k], avg, norm: Math.round((avg-1)/4*100) };
  }).sort((a,b)=>b.norm-a.norm);
}

/* ===== 조합키 정렬 & 이름 - 그대로 유지 ===== */
function toComboKey(a,b,c){
  const order = ['C','L','M','P','R','S','T','W']; // C, L, M, P, R, S, T, W 순서로 정렬 (요청된 56개 조합 순서와 동일)
  return [a,b,c].sort((x,y)=>order.indexOf(x)-order.indexOf(y)).join('+');
}
function typeNameByKey(k){ return (TYPES.find(t=>t.key===k)||{}).name || k; }

/* ===== 수정된 결과 렌더 (56가지 조합 내용 적용) ===== */
function renderResult(){
  const scores = calcScores();
  const top3 = scores.slice(0,3);

  // 실제 계산된 조합 키 사용
  const comboKey = toComboKey(top3[0].key, top3[1].key, top3[2].key);
  const combo = COMBO[comboKey] || {title:`${comboKey} 조합`, desc:'세 은사가 조화를 이루어 공동체에 독특한 기여를 기대할 수 있습니다.', examples:['조합에 대한 상세 설명이 준비되지 않았습니다.','다른 조합 결과는 연구 중입니다.','본 결과는 참고용이며, 다른 조합도 테스트해 보세요.','말씀과 기도로 분별하시길 권장합니다.',' ']} ;

  // 은사 영역 이름 추출 (사용하지 않음)
  const areaText = [top3[0].key, top3[1].key, top3[2].key].map(k=>typeNameByKey(k)).join(' · ');

  // 유저 정보 표시
  const nameDisplay = state.name ? state.name + ' 님' : '응답자 님';
  $('#result-sub-info').innerHTML = `${nameDisplay} (${state.gender}, ${state.age})`;

  // 조합 요약 박스 업데이트 (수정)
  const examplesList = combo.examples.map(ex => `<li class="mt-2 text-slate-700">${ex}</li>`).join('');

  $('#top3').innerHTML = `
    <article class="rounded-xl border-4 border-violet-500 p-6 sm:p-8 bg-violet-50 shadow-lg text-center">
      <div class="text-sm text-violet-600 font-bold mb-2 tracking-widest">
        MY TALENT ARCHETYPE (${top3[0].key}+${top3[1].key}+${top3[2].key} 조합)
      </div>
      <h5 class="text-3xl sm:text-4xl font-extrabold text-violet-800">
        ${combo.title}
      </h5>
      <p class="mt-4 text-lg text-slate-700 leading-relaxed font-medium">
        ${combo.desc}
      </p>

      <div class="mt-6 pt-6 border-t border-violet-200 text-left">
        <h5 class="text-xl font-bold mb-4 text-slate-800">
          현실적인 교회 현장 사역 TOP 5
        </h5>
        <ul class="list-decimal list-inside text-left space-y-2 pl-4">
          ${examplesList}
        </ul>
      </div>

      <p class="mt-8 text-sm text-violet-700 font-semibold border-t pt-4">
        **[신학적 권면]** 본 검사는 선생님께서 만드신 기독교교육학적 탐색 도구로서, 은사 조합은 사역의 **방향성을 제시**할 뿐입니다. 이 결과를 **말씀과 기도** 안에서 깊이 분별하고, **성령의 구체적인 부르심**을 따라 **목회적/신학적 지도**를 받아 사역의 확신을 세우시기를 권장합니다.
      </p>

    </article>
  `;

  // 세부 점수 테이블 렌더링
  const tbl = $('#score-table'); tbl.innerHTML='';
  scores.forEach((s, idx)=>{
    const rank = idx + 1;
    const isTop = rank <= 3;
    const badge = isTop
      ? `<span class="ml-2 shrink-0 inline-flex items-center justify-center text-xs px-2 py-0.5 rounded-full bg-violet-100 text-violet-700 font-semibold">TOP ${rank}</span>`
      : '';
    const scoreColor = isTop ? 'text-violet-800 text-lg font-extrabold' : 'text-slate-700 font-semibold';

    tbl.insertAdjacentHTML('beforeend',
      `<div class="px-4 py-3 rounded-xl bg-white border border-slate-200 flex items-center justify-between min-w-0 shadow-sm">
         <span class="flex items-center whitespace-nowrap min-w-0">
           <b class="shrink-0 text-violet-600">${s.key}</b><span class="mx-1 text-slate-400">|</span>
           <span class="truncate text-slate-700 font-medium">${s.name}</span>${badge}
         </span>
         <span class="${scoreColor} shrink-0 ml-3">${s.norm}</span>
       </div>`);
  });
}

/* ===== 데이터 저장 - 그대로 유지 ===== */
async function saveToSheets(payload){
  try{
    await fetch(WEB_APP_URL, {
      method:'POST',
      mode:'no-cors',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
  }catch(e){ console.error('시트 저장 실패:', e); }
}

/* ===== 네비게이션 - 그대로 유지 ===== */
async function next(){
  const sel = document.querySelector(`input[name="q${state.i}"]:checked`);
  if(!sel){ alert('답변을 선택해야 다음으로 넘어갈 수 있습니다.'); return; }

  state.rt[state.i] = Math.round(performance.now() - qStart);
  state.answers[state.i] = Number(sel.value);

  if(state.i >= QUESTIONS.length-1){
    const scores = calcScores();
    const payload = {
      timestamp: new Date().toISOString(),
      instrumentVersion: 'std60_youth_v1_test4_design_v3', // 버전명 업데이트
      user: { name: state.name, gender: state.gender, ageGroup: state.age, region: state.region },
      answers: state.answers,
      rt_ms: state.rt,
      scoresRaw: scores.reduce((o,s)=> (o[s.key]=s.sum, o), {}),
      scoresNorm: scores.reduce((o,s)=> (o[s.key]=s.norm, o), {}),
      top: scores.slice(0,3).map(s=>({type:s.key, name:s.name, norm:s.norm}))
    };
    await saveToSheets(payload);
    showResult();
  } else {
    state.i++; renderQuestion();
  }
}
function prev(){ if(state.i>0){ state.i--; renderQuestion(); } }
</script>
</body>
</html>
